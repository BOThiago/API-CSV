(function(){"use strict";var r=function(r,e){if(0===r.length)return"";for(var n="",i=0,u=r.length;i<u;i++)if(t(r[i])&&r[i])n+=(n?".":"")+m(r[i]);else{if(!a(r[i]))return!1;e||(n+=(n?".":"")+"["+r[i]+"]")}return n||!1},e=function(e,n){return(r(e)||"<root>")+": "+n},n=function(r){return Object.prototype.toString.call(r)};n.Boolean=n(!1),n.String=n(""),n.Number=n(0),n.Array=n([]),n.Date=n(new Date(0));var t=function(r){return"string"==typeof r},a=function(r){return"number"==typeof r},i=Array.isArray||function(r){return n(r)===n.Array},u=function(r){return n(r)===n.Date},l=function(r){return null!==r&&"object"==typeof r&&!(i(r)||u(r))},o=function(r){if(r.length<2)return!1;for(var e=n(r[0]),t=1,a=r.length;t<a;t++)if(null!=r[t]&&n(r[t])!==e)return!0;return!1},f=function(r){if(r.length<1)return!1;for(var e=0,n=r.length;e<n;e++)if(l(r[e]))return!0;return!1},p=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},c=function(r){var e=function(r,n){if(!i(r)&&!l(r))return!1;if(-1!==n.indexOf(r))return!0;n.push(r);for(var t in r)if(p(r,t)){var a=n.length;if(e(r[t],n))return!0;n.splice(a)}return!1};return e(r,[])},s=function(r,e,n){return n?"true":"false"},h=function(r,e,n){return"object"==typeof JSON&&JSON?JSON.stringify(n):'"'+String(n).replace(/[\x00-\x1F"\\]/g,function(r){switch(r){case'"':case"\\":return"\\"+r;case"\t":return"\\t";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";case"\f":return"\\f";default:var e=r.charCodeAt(0).toString(16);return"\\u"+"0000".substr(e.length)+e}})+'"'},v=function(r,n,t){if(!isFinite(t))throw new Error(e(r.path,"Number must be finite."));var a;return a=(Number.isInteger?Number.isInteger(t):Math.floor(t)===t)?t.toFixed(1):String(t),a=a.replace(/([eE])(\d)/,"$1+$2"),/[.eE]/.test(a)?a:a+".0"},b=function(r,n,a){if(o(a))throw new Error(e(r.path,"Array cannot contain values of different types."));var i=r.table;r.table=a;var u=[],l=r.inPair;f(a)&&(r.inPair=!0);for(var p=0,c=a.length;p<c;p++){r.path.push(p);var s=w(r,p,a[p]);t(s)&&u.push(s),r.path.pop()}return r.inPair=l,r.table=i,!r.inPair&&u.length>0&&r.space?"[\n"+O(u.join(",\n"),1,r.space)+"\n]":"["+u.join(", ")+"]"},g=function(r,n,t){if(!isFinite(t.getTime()))throw new Error(e(r.path,"Invalid Date"));return t.toISOString()},y=function(r,n,a){var i=r.table;r.table=a;var u=r.inPair;r.inPair=!0;var l=[];for(var o in a)if(p(a,o)&&null!=a[o]){if(!o)throw new Error(e(r.path,"Key cannot be an empty string."));r.path.push(o);var f=w(r,o,a[o]);t(f)&&l.push(m(o)+" = "+f),r.path.pop()}return r.inPair=u,r.table=i,"{"+l.join(", ")+"}"},w=function(r,a,i){if(r.replace){var u=r.replace.call(E(r),a,i);if(t(u))return u;if(null==u)return null;if(!1!==u)throw new Error(e(r.path,"Replacer must return a string, false, null or undefined."))}switch(n(i)){case n.Boolean:return s(0,0,i);case n.String:return h(0,0,i);case n.Number:return v(r,0,i);case n.Array:return b(r,0,i);case n.Date:return g(r,0,i);default:return null==i?null:y(r,0,i)}},d=function(r,e,n){return x(r),w({path:[],table:{"":r},inTableArray:!1,replace:N(e),level:0,space:P(n)},"",r)},m=function(r){return!!r&&(/^[a-zA-Z0-9\-_]+$/.test(r)?r:h(0,0,r))},A=function(r,n,a){var i=m(n);if(!i)throw new Error(e(r.path,"Key cannot be an empty string."));var u=w(r,n,a);return t(u)?i+" = "+u:null},E=function(r){return{path:r.path.slice(0),table:r.table}},S=function(r,n,a){if(r.replace){var i=r.replace.call(E(r),n,a);if(t(i))return m(n)+" = "+i;if(null==i)return null;if(!1!==i)throw new Error(e(r.path,"Replacer must return a string, false, null or undefined."))}return!1},T=function(r,e,n,a){var u;if(!(r.replace&&0===r.path.length&&(u=S(r,e,n),t(u)&&r.lines.push(u),!1!==u)||a(r,e,n))){var o=r.table;if(r.table=n,i(n)){h=r.inTableArray;r.inTableArray=f(n);for(var c=0,s=n.length;c<s;c++)r.path.push(c),T(r,c,n[c],a),r.path.pop();r.inTableArray=h}else if(l(n)){var h=r.inTableArray;r.inTableArray=!1;var v=[],b=[];for(var g in n)if(p(n,g)){var y=n[g],w=r.path.length>0&&(i(y)?f(y):l(y));i(y)&&f(y)?b.push(g,y,w):l(y)?v.push(g,y,w):(r.path.push(g),T(r,g,y,a),r.path.pop())}if(r.replace){for(var c=0,s=v.length;c<s;c+=3)r.path.push(v[c]),!1!==(u=S(r,v[c],v[c+1]))&&(t(u)&&r.lines.push(O(u,r.level,r.space)),v[c+1]=null),r.path.pop();for(var c=0,s=b.length;c<s;c+=3)if(r.path.push(b[c]),!1===(u=S(r,b[c],b[c+1]))){for(var d=0,g=b[c+1].length;d<g;d++){r.path.push(d);var m=b[c+1][d];if(u=S(r,d,m),r.path.pop(),!1!==u){if(null==u){b[c+1][d]=null;continue}u=A(r,b[c],b[c+1]),t(u)&&r.lines.push(O(u,r.level,r.space)),b[c+1]=null;break}}r.path.pop()}else t(u)&&r.lines.push(O(u,r.level,r.space)),b[c+1]=null,r.path.pop()}for(var E=v.concat(b),c=0,s=E.length;c<s;c+=3)null!=E[c+1]&&(r.path.push(E[c]),E[c+2]&&r.level++,T(r,E[c],E[c+1],a),E[c+2]&&r.level--,r.path.pop());r.inTableArray=h}r.table=o}},j=function(r,e){if(r.repeat)return r.repeat(e);for(var n="",t="";e>0;)t+=t||r,1&e&&(n+=t),e>>>=1;return n},O=function(r,e,n){var t=j(n,e);return r.replace(/^(?!$)/gm,t)},P=function(r){return t(r)?r:a(r)&&r>=0&&isFinite(r)&&Math.floor(r)===r?j(" ",r):""},N=function(r){return"function"==typeof r?r:null},x=function(r){if(null==r)throw new Error("Undefined or null cannot be stringified.");if(c(r))throw new Error("Converting circular structure to TOML.")},D=function(e,n,a){x(e),n=N(n),a=P(a);var u=[];return T({path:[],table:{"":e},inPair:!1,inTableArray:!1,replace:n,level:0,space:a,lines:u},"",e,function(e,n,a){var o=null;if(l(a))""!==n&&(u.length>0&&u.push(""),o=e.inTableArray?"[["+r(e.path,!0)+"]]":"["+r(e.path,!0)+"]",u.push(O(o,e.level,e.space)));else{if(!i(a))return t(n)&&(o=A(e,n,a),t(o)&&u.push(O(o,e.level,e.space))),!0;if(!t(n))return!0;f(a)||(o=A(e,n,a),t(o)&&u.push(O(o,e.level,e.space)))}}),u.join("\n")},K=function(r,e,n){return l(r)?D(r,e,n):d(r,e,n)};K.toToml=function(r,e,n){if(!l(r))throw new Error("An object other than Array or Date is expected.");return D(r,e,n)},K.toKey=function(e,n){if(t(e)){if(!(a=m(e)))throw new Error("Key cannot be an empty string.");return a}if(i(e)){var a=r(e,n);if(!1===a)throw new Error("Key path must consist of non-empty string(s).");return a}throw new Error("Invalid Arguments for tomlify.toKey({String | Array})")},K.toValue=d,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=K:"function"==typeof define&&define.amd?define([],function(){return K}):this.tomlify=K}).call(this);